<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>1. Exploratory Data Analysis: Italian Earthquake Catalogue - Horus • ETAS.inlabru</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="1. Exploratory Data Analysis: Italian Earthquake Catalogue - Horus">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ETAS.inlabru</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.1.9002</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/EDA_Italy_Horus.html">1. Exploratory Data Analysis: Italian Earthquake Catalogue - Horus</a></li>
    <li><a class="dropdown-item" href="../articles/generateSyntheticCatalogues.html">2a Temporal Model: Generating synthetic temporal ETAS catalogues</a></li>
    <li><a class="dropdown-item" href="../articles/sampleFromETASpriors.html">2b Temporal Model: Presenting samples drawn from the ETAS priors</a></li>
    <li><a class="dropdown-item" href="../articles/sensitivityToStartingPoint.html">Sensitivity to starting point</a></li>
    <li><a class="dropdown-item" href="../articles/tutorial_real.html">2d Temporal Model: Tutorial on real data</a></li>
    <li><a class="dropdown-item" href="../articles/tutorial_synth.html">2c Temporal Model: Tutorial on synthetic data</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/edinburgh-seismicity-hub/ETAS.inlabru/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>1. Exploratory Data Analysis: Italian Earthquake Catalogue - Horus</h1>
                        <h4 data-toc-skip class="author">Mark
Naylor</h4>
            
            <h4 data-toc-skip class="date">2023-06-27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/edinburgh-seismicity-hub/ETAS.inlabru/blob/main/vignettes/articles/EDA_Italy_Horus.Rmd" class="external-link"><code>vignettes/articles/EDA_Italy_Horus.Rmd</code></a></small>
      <div class="d-none name"><code>EDA_Italy_Horus.Rmd</code></div>
    </div>

    
    
<p>Prior to any statistical analysis, it is important to explore the
properties of the dataset. Earthquake catalogues are composed of
estimates of the spatial location of events, their data-time, a measure
of their magnitude and their depth. The depth is most prone to
uncertainty and artefacts, followed by the estimate of the magnitude for
which there can be a range of values depending upon the method used to
estimate it. Some catalogues also attempt to estimate uncertainty in
these parameters.</p>
<p>Below, we provide examples of the sorts of plots you can do to
understand important features of catalogue data. -
<code>ETAS.inlabru</code> currently requires that a b-value to descrive
the frequency-magnitude of earthquakes is provided to the model, so we
show how this can be evaluated. - We have choices in how we subset data
for regional events, and we use the example of l’Aquila to show how this
can be implemented.</p>
<p>What we don’t show in this notebook is how to input the data into a
dataframe in the first place. We reccommend using the same column names
as below so that it is easy to copy and modify the code.</p>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="section level3">
<h3 id="load-packages">Load Packages<a class="anchor" aria-label="anchor" href="#load-packages"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/">ETAS.inlabru</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rnaturalearth/" class="external-link">rnaturalearth</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://paleolimbot.github.io/ggspatial/" class="external-link">ggspatial</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rnaturalearthdata/" class="external-link">rnaturalearthdata</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">## This is just the EPSG equivalent of WGS84</span></span>
<span><span class="va">crs_wgs84</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="st">"EPSG:4326"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="load-an-earthquake-catalogue">Load an earthquake catalogue<a class="anchor" aria-label="anchor" href="#load-an-earthquake-catalogue"></a>
</h2>
<p>Earthquake data is stored in the so-called earthquake catalogues.
Many different catalogues exists for the same region and there is no
easy way to decide which one is better. Here, we provide the HOmogenized
instRUmental Seismic (HORUS) catalogue from 1960 to 2020. It can be
downloaded from <a href="http://horus.bo.ingv.it/" class="external-link">http://horus.bo.ingv.it/</a>. A subset
(see <a href="https://github.com/edinburgh-seismicity-hub/ETAS.inlabru/blob/main/R/AnalysingPosteriors.R" class="external-link">data-raw/horus.R</a>
for how the the subset was created) of the information in the Horus
catalogue can be loaded using</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load HORUS catalogue</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">horus</span>, package <span class="op">=</span> <span class="st">"ETAS.inlabru"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># transform time string in Date object</span></span>
<span><span class="va">horus</span><span class="op">$</span><span class="va">time_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span></span>
<span>  <span class="va">horus</span><span class="op">$</span><span class="va">time_string</span>,</span>
<span>  format <span class="op">=</span> <span class="st">"%Y-%m-%dT%H:%M:%OS"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">horus</span><span class="op">)</span></span>
<span><span class="co">#&gt;           time_string     lon     lat depth    M           time_date</span></span>
<span><span class="co">#&gt; 1 1960-01-03T20:19:34 15.3000 39.3000   290 6.34 1960-01-03 20:19:34</span></span>
<span><span class="co">#&gt; 2 1960-01-04T09:20:00 13.1667 43.1333     0 3.94 1960-01-04 09:20:00</span></span>
<span><span class="co">#&gt; 3 1960-01-06T15:17:34 12.7000 46.4833     4 4.69 1960-01-06 15:17:34</span></span>
<span><span class="co">#&gt; 4 1960-01-06T15:20:53 12.7000 46.4667     0 4.14 1960-01-06 15:20:53</span></span>
<span><span class="co">#&gt; 5 1960-01-06T15:31:00 12.7500 46.4333     0 3.00 1960-01-06 15:31:00</span></span>
<span><span class="co">#&gt; 6 1960-01-06T15:45:00 12.7500 46.4333     0 3.00 1960-01-06 15:45:00</span></span>
<span></span>
<span><span class="co"># Set df_cat to be the catalogue we want to analyse and then use this below</span></span>
<span><span class="va">df_cat</span> <span class="op">&lt;-</span> <span class="va">horus</span></span>
<span></span>
<span><span class="co"># Add an integer id to each event</span></span>
<span><span class="va">df_cat</span><span class="op">$</span><span class="va">event_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq.int</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df_cat</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate an sf version of the catalogue where the longitude and latitude are</span></span>
<span><span class="co"># converted to a point object</span></span>
<span><span class="va">df_cat.sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">df_cat</span>,</span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span><span class="op">)</span>,</span>
<span>  crs <span class="op">=</span> <span class="va">crs_wgs84</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df_cat.sf</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 5 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 12.7 ymin: 39.3 xmax: 15.3 ymax: 46.4833</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt;           time_string depth    M           time_date event_num</span></span>
<span><span class="co">#&gt; 1 1960-01-03T20:19:34   290 6.34 1960-01-03 20:19:34         1</span></span>
<span><span class="co">#&gt; 2 1960-01-04T09:20:00     0 3.94 1960-01-04 09:20:00         2</span></span>
<span><span class="co">#&gt; 3 1960-01-06T15:17:34     4 4.69 1960-01-06 15:17:34         3</span></span>
<span><span class="co">#&gt; 4 1960-01-06T15:20:53     0 4.14 1960-01-06 15:20:53         4</span></span>
<span><span class="co">#&gt; 5 1960-01-06T15:31:00     0 3.00 1960-01-06 15:31:00         5</span></span>
<span><span class="co">#&gt; 6 1960-01-06T15:45:00     0 3.00 1960-01-06 15:45:00         6</span></span>
<span><span class="co">#&gt;                  geometry</span></span>
<span><span class="co">#&gt; 1       POINT (15.3 39.3)</span></span>
<span><span class="co">#&gt; 2 POINT (13.1667 43.1333)</span></span>
<span><span class="co">#&gt; 3    POINT (12.7 46.4833)</span></span>
<span><span class="co">#&gt; 4    POINT (12.7 46.4667)</span></span>
<span><span class="co">#&gt; 5   POINT (12.75 46.4333)</span></span>
<span><span class="co">#&gt; 6   POINT (12.75 46.4333)</span></span></code></pre></div>
<p>The data reports for each earthquake the time as a string
(<code>time_string</code>), the longitude (<code>lon</code>) and
latitude (<code>lat</code>) of the epicentre, the depth in kilometres
(<code>depth</code>), and the moment magnitude (<code>M</code>).</p>
<div class="section level3">
<h3 id="get-map-and-extract-crs-for-the-map">Get map and extract crs for the map<a class="anchor" aria-label="anchor" href="#get-map-and-extract-crs-for-the-map"></a>
</h3>
<p>We download a polygon file for the national boundary of Italy for use
later in this notebook.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">italy.map</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_countries.html" class="external-link">ne_countries</a></span><span class="op">(</span>country <span class="op">=</span> <span class="st">"Italy"</span>, returnclass <span class="op">=</span> <span class="st">"sf"</span>, scale <span class="op">=</span> <span class="st">"medium"</span><span class="op">)</span></span>
<span><span class="va">italy.crs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">italy.map</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">italy.crs</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "GEOGCRS[\"WGS 84\",\n    DATUM[\"World Geodetic System 1984\",\n        ELLIPSOID[\"WGS 84\",6378137,298.257223563,\n            LENGTHUNIT[\"metre\",1]]],\n    PRIMEM[\"Greenwich\",0,\n        ANGLEUNIT[\"degree\",0.0174532925199433]],\n    CS[ellipsoidal,2],\n        AXIS[\"geodetic latitude (Lat)\",north,\n            ORDER[1],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n        AXIS[\"geodetic longitude (Lon)\",east,\n            ORDER[2],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n    ID[\"EPSG\",4326]]"</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">italy.map</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Map of the Italian territorial boundary and coastline"</span><span class="op">)</span></span></code></pre></div>
<p><img src="EDA_Italy_Horus_files/figure-html/unnamed-chunk-2-1.png" class="r-plt" alt="" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="exploratory-data-analysis-on-the-whole-of-italy-using-the-horus-catalogue">Exploratory Data Analysis on the whole of Italy using the Horus
catalogue<a class="anchor" aria-label="anchor" href="#exploratory-data-analysis-on-the-whole-of-italy-using-the-horus-catalogue"></a>
</h2>
<div class="section level3">
<h3 id="histogram-of-event-depths">Histogram of event depths<a class="anchor" aria-label="anchor" href="#histogram-of-event-depths"></a>
</h3>
<p>The histogram of depth data with 1km bins initially looks reasonable
except for the artefact of a cluster of events at zero depth.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/hist.html" class="external-link">hist</a></span><span class="op">(</span></span>
<span>  <span class="va">df_cat</span><span class="op">$</span><span class="va">depth</span>,</span>
<span>  breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">650</span>, <span class="op">-</span><span class="fl">5</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">40</span><span class="op">)</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Histogram of depths, 1km bins"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Depth [km]"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="EDA_Italy_Horus_files/figure-html/unnamed-chunk-3-1.png" class="r-plt" alt="" width="700"></p>
<p>However, when we reduce the bin width to 100m we see that there are
more artefacts in the data. The spikes at 0, 5, 10 and 11km are
artefacts of the depth estimation, one cause is that that the algorithms
may have got stuck at their starting values.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/hist.html" class="external-link">hist</a></span><span class="op">(</span></span>
<span>  <span class="va">df_cat</span><span class="op">$</span><span class="va">depth</span>,</span>
<span>  breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">650</span>, <span class="op">-</span><span class="fl">5</span>, <span class="op">-</span><span class="fl">0.1</span><span class="op">)</span>,</span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">40</span><span class="op">)</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Histogram of depths (100m bins)"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Depth [km]"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="EDA_Italy_Horus_files/figure-html/unnamed-chunk-4-1.png" class="r-plt" alt="" width="700">
The magnitude time series shows how the completeness of intermediate and
deep events has improved over time.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_cat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time_date</span>, y <span class="op">=</span> <span class="va">depth</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">620</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Depth timeseries using natural time"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 3 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span></code></pre></div>
<p><img src="EDA_Italy_Horus_files/figure-html/unnamed-chunk-5-1.png" class="r-plt" alt="" width="700"></p>
</div>
<div class="section level3">
<h3 id="plot-of-event-magnitudes-using-natural-time">Plot of event magnitudes using natural time<a class="anchor" aria-label="anchor" href="#plot-of-event-magnitudes-using-natural-time"></a>
</h3>
<p>Natural time refers to where we plot each event evenly spaced along
the x-axis. The advantage of this is that data that occurs in periods of
high activity are spread out, which means that we can see structure in
the data when the rates are high.</p>
<p>Below we plot the magnitude of the events on the y-axis and natural
time on the horizontal.</p>
<p>Some of the observations are:</p>
<ul>
<li>There are over 40,000 events with magnitude data</li>
<li>There is a cluster of events with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">M=0</annotation></semantics></math>
which is likely to be an artefact of how the catalogue is generated</li>
<li>There are period of time when the data are all rounded to 1 decimal
place producing horizontal banding</li>
<li>At other times, some of the data is not rounded</li>
<li>The sensitivity at the lowest magnitudes varies in time as can be
seen by the changes in the lowest magnitudes</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_cat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">event_num</span>, y <span class="op">=</span> <span class="va">M</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Magnitude timeseries using natural time"</span><span class="op">)</span></span></code></pre></div>
<p><img src="EDA_Italy_Horus_files/figure-html/unnamed-chunk-6-1.png" class="r-plt" alt="" width="700"></p>
</div>
<div class="section level3">
<h3 id="plot-of-event-magnitudes-using-date-time">Plot of event magnitudes using date-time<a class="anchor" aria-label="anchor" href="#plot-of-event-magnitudes-using-date-time"></a>
</h3>
<p>Here we present the same data as in the previous plot, but plotted
against the data-time. Clustered events now sit on top of each other. We
get a better representaion of how the data density increases towards the
modern day and how the magnitude incompleteness varyies in time.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_cat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time_date</span>, y <span class="op">=</span> <span class="va">M</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Horus catalogue magnitude time series"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 1 row containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span></code></pre></div>
<p><img src="EDA_Italy_Horus_files/figure-html/Magnitude%20natural-time%20series-1.png" class="r-plt" alt="" width="700"></p>
<p>The number of events occuring each year is difficult to assess in
this plot, so below we group the data by year and count the number of
events occuring each year. The plot of this shows how the number of
events being recorded each year is gradually increasing. This artefact
is due to the gradual increase in the sensitivity of the network, not
that the seismicity is systematically increasing.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_cat</span><span class="op">$</span><span class="va">Time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">df_cat</span><span class="op">$</span><span class="va">time_date</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Extract year"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Extract year"</span></span>
<span><span class="co"># extract the year and convert to numeric format</span></span>
<span><span class="va">df_cat</span><span class="op">$</span><span class="va">Year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">df_cat</span><span class="op">$</span><span class="va">Time</span>, <span class="st">"%Y"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">countEventsInYear</span> <span class="op">&lt;-</span> <span class="va">df_cat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>counts <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">countEventsInYear</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"l"</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Annual number of events for whole catalogue"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="EDA_Italy_Horus_files/figure-html/unnamed-chunk-7-1.png" class="r-plt" alt="" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filtered for M&gt;4</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_cat</span><span class="op">[</span><span class="va">df_cat</span><span class="op">$</span><span class="va">M</span> <span class="op">&gt;</span> <span class="fl">4</span>, <span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time_date</span>, y <span class="op">=</span> <span class="va">M</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Whole catalogue magnitude timeseries for M&gt;4"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 1 row containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span></code></pre></div>
<p><img src="EDA_Italy_Horus_files/figure-html/Magnitude%20time%20series-1.png" class="r-plt" alt="" width="700"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">countEventsInYear</span> <span class="op">&lt;-</span> <span class="va">df_cat</span><span class="op">[</span><span class="va">df_cat</span><span class="op">$</span><span class="va">M</span> <span class="op">&gt;=</span> <span class="fl">4</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>counts <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">countEventsInYear</span>, type <span class="op">=</span> <span class="st">"l"</span>, main <span class="op">=</span> <span class="st">"Annual number of events with M&gt;=4"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">countEventsInYear</span><span class="op">)</span>, col <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in mean.default(countEventsInYear): argument is not numeric or logical:</span></span>
<span><span class="co">#&gt; returning NA</span></span></code></pre></div>
<p><img src="EDA_Italy_Horus_files/figure-html/unnamed-chunk-8-1.png" class="r-plt" alt="" width="700"></p>
</div>
<div class="section level3">
<h3 id="frequency-magnitude-analysis-for-horus-catalogue">Frequency-magnitude analysis for Horus catalogue<a class="anchor" aria-label="anchor" href="#frequency-magnitude-analysis-for-horus-catalogue"></a>
</h3>
<p>The traditional GR plot shows cumulative data (red) and we also show
the incremental data (black). I personally prefer looking at the
incremental data because it is not correlated and therefore easier to
understand how Poisson counting errors account for uncertainty in the
data.</p>
<p>There are three domains in a standard GR plot. - At low magnitudes
there will always be incompleteness due to limitations of the monitoring
network - A requirement of GR being a good model is that there is a
log-linear portion of the data where the slope is stable, this slope is
refered to as the b-value - At high magnitudes there will always be
fluctuations in the magnitudes due to the effect of counting errors on
bins with low rates</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">minMag</span> <span class="op">&lt;-</span> <span class="fl">1.5</span></span>
<span><span class="va">maxMag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">df_cat</span><span class="op">$</span><span class="va">M</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mags</span> <span class="op">&lt;-</span> <span class="va">df_cat</span><span class="op">[</span><span class="va">df_cat</span><span class="op">$</span><span class="va">M</span> <span class="op">&gt;</span> <span class="va">minMag</span>, <span class="op">]</span><span class="op">$</span><span class="va">M</span></span>
<span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">mags</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">minMag</span> <span class="op">-</span> <span class="fl">0.05</span>, <span class="va">maxMag</span> <span class="op">+</span> <span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">)</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">N.counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">$</span><span class="va">counts</span><span class="op">)</span></span>
<span><span class="va">tmp</span><span class="op">$</span><span class="va">cumulativeCounts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">$</span><span class="va">counts</span><span class="op">[</span><span class="va">N.counts</span><span class="op">:</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="va">N.counts</span><span class="op">:</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="va">m.min</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span><span class="va">bin_m.min</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">$</span><span class="va">mids</span> <span class="op">==</span> <span class="va">m.min</span><span class="op">)</span></span>
<span><span class="va">freq_m.min</span> <span class="op">&lt;-</span> <span class="va">tmp</span><span class="op">$</span><span class="va">counts</span><span class="op">[</span><span class="va">bin_m.min</span><span class="op">]</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">tmp</span><span class="op">$</span><span class="va">mids</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">freq_m.min</span> <span class="op">*</span> <span class="fl">10</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="va">b</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">m.min</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">y.cum</span> <span class="op">&lt;-</span> <span class="va">tmp</span><span class="op">$</span><span class="va">cumulativeCounts</span><span class="op">[</span><span class="va">bin_m.min</span><span class="op">]</span> <span class="op">*</span> <span class="fl">10</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="va">b</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">m.min</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">tmp</span><span class="op">$</span><span class="va">mids</span>, y <span class="op">=</span> <span class="va">tmp</span><span class="op">$</span><span class="va">counts</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">tmp</span><span class="op">$</span><span class="va">mids</span>, y <span class="op">=</span> <span class="va">tmp</span><span class="op">$</span><span class="va">cumulativeCounts</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    pch <span class="op">=</span> <span class="st">"+"</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Frequency-magnitude plot with arbitary GR dist: b ="</span>, <span class="va">b</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Magnitude"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"log10(Frequency)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y.cum</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">m.min</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in scale_y_log10(): <span style="color: #00BB00;">log-10</span> transformation introduced</span></span>
<span><span class="co">#&gt; infinite values.</span></span></code></pre></div>
<p><img src="EDA_Italy_Horus_files/figure-html/National%20GR%20Plot-1.png" class="r-plt" alt="" width="700"></p>
</div>
<div class="section level3">
<h3 id="b-value-stability-plot-for-the-events-in-the-horus-catalogue">b-value stability plot for the events in the Horus catalogue<a class="anchor" aria-label="anchor" href="#b-value-stability-plot-for-the-events-in-the-horus-catalogue"></a>
</h3>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">minMag</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">maxMag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">df_cat</span><span class="op">$</span><span class="va">M</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">mags</span> <span class="op">&lt;-</span> <span class="va">df_cat</span><span class="op">[</span><span class="va">df_cat</span><span class="op">$</span><span class="va">M</span> <span class="op">&gt;=</span> <span class="va">minMag</span>, <span class="op">]</span><span class="op">$</span><span class="va">M</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">minMag</span>, <span class="va">maxMag</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">b.stability.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">b.error.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">m.mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">b_utsu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">b_guttorp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">b_elst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">delta_b_utsu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">b_elst_lower</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">b_elst_upper</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">max.index.x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">max.index.x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">mag.threshold</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">mags.subset</span> <span class="op">&lt;-</span> <span class="va">mags</span><span class="op">[</span><span class="va">mags</span> <span class="op">&gt;</span> <span class="va">mag.threshold</span><span class="op">]</span></span>
<span></span>
<span>  <span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mags.subset</span><span class="op">)</span></span>
<span>  <span class="va">b_utsu</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mags.subset</span><span class="op">)</span> <span class="op">-</span> <span class="va">mag.threshold</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">delta_b_utsu</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="op">*</span> <span class="va">b_utsu</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">**</span><span class="fl">2</span> <span class="op">*</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">mags.subset</span> <span class="op">-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mags.subset</span><span class="op">)</span><span class="op">)</span><span class="op">**</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">N</span> <span class="op">*</span> <span class="op">(</span><span class="va">N</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">b_guttorp</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="fl">0.05</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mags.subset</span><span class="op">)</span> <span class="op">-</span> <span class="va">mag.threshold</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">/</span></span>
<span>      <span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mags.subset</span><span class="op">)</span> <span class="op">-</span> <span class="va">mag.threshold</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">deltaMags</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">mags.subset</span><span class="op">)</span></span>
<span>  <span class="va">deltaMags_p</span> <span class="op">&lt;-</span> <span class="va">deltaMags</span><span class="op">[</span><span class="va">deltaMags</span> <span class="op">&gt;</span> <span class="fl">0.1</span><span class="op">]</span></span>
<span>  <span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">deltaMags_p</span><span class="op">)</span></span>
<span>  <span class="va">b_elst</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="fl">0.05</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">deltaMags_p</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">deltaMags_p</span><span class="op">)</span> <span class="op">-</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">c</span> <span class="op">&lt;-</span> <span class="fl">10</span><span class="op">**</span><span class="op">(</span><span class="fl">0.1</span> <span class="op">*</span> <span class="va">b_elst</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">b_elst_lower</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">0.1</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="op">(</span><span class="va">c</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">c</span> <span class="op">/</span> <span class="va">N</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">c</span> <span class="op">/</span> <span class="va">N</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">b_elst_upper</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">0.1</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="op">(</span><span class="va">c</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">c</span> <span class="op">/</span> <span class="va">N</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">c</span> <span class="op">/</span> <span class="va">N</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">max.index.x</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">b_utsu</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">max.index.x</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">b_utsu</span> <span class="op">+</span> <span class="va">delta_b_utsu</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    lty <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">max.index.x</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">b_utsu</span> <span class="op">-</span> <span class="va">delta_b_utsu</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="fl">2</span>, lty <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">max.index.x</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">b_guttorp</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="fl">3</span>, lty <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Magnitude threshold"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"b-value estimate"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">1</span>, lty <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0.85</span>, lty <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"b-value stability plot for Horus catalogue"</span><span class="op">)</span></span></code></pre></div>
<p><img src="EDA_Italy_Horus_files/figure-html/National%20b-value%20stability-1.png" class="r-plt" alt="" width="700"></p>
</div>
<div class="section level3">
<h3 id="heatmap-of-the-events-in-the-horus-catalogue">Heatmap of the events in the Horus catalogue<a class="anchor" aria-label="anchor" href="#heatmap-of-the-events-in-the-horus-catalogue"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_hex.html" class="external-link">geom_hex</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_cat</span><span class="op">[</span><span class="va">df_cat</span><span class="op">$</span><span class="va">M</span> <span class="op">&gt;</span> <span class="fl">3</span>, <span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lon</span>, y <span class="op">=</span> <span class="va">lat</span><span class="op">)</span>, bins <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_continuous.html" class="external-link">scale_fill_continuous</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"viridis"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">italy.map</span>,</span>
<span>    fill <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html" class="external-link">alpha</a></span><span class="op">(</span><span class="st">"lightgrey"</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"orange"</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">0.2</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Density plot for M&gt;3 events"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="EDA_Italy_Horus_files/figure-html/hexbin%20event%20density-1.png" class="r-plt" alt="" width="700"></p>
</div>
<div class="section level3">
<h3 id="map-of-the-events-in-the-italian-horus-catalogue">Map of the events in the Italian Horus catalogue<a class="anchor" aria-label="anchor" href="#map-of-the-events-in-the-italian-horus-catalogue"></a>
</h3>
<p>Here we plot the location of the seismicity on a map. The outline of
the Italy territory is shown in green.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_cat.sf</span><span class="op">[</span><span class="va">df_cat</span><span class="op">$</span><span class="va">M</span> <span class="op">&gt;</span> <span class="fl">3</span>, <span class="op">]</span>, size <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">italy.map</span>,</span>
<span>    fill <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html" class="external-link">alpha</a></span><span class="op">(</span><span class="st">"lightgrey"</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"green"</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">0.7</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_cat.sf</span><span class="op">[</span><span class="va">df_cat</span><span class="op">$</span><span class="va">M</span> <span class="op">&gt;</span> <span class="fl">5</span>, <span class="op">]</span>, size <span class="op">=</span> <span class="fl">0.5</span>, color <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_cat.sf</span><span class="op">[</span><span class="va">df_cat</span><span class="op">$</span><span class="va">M</span> <span class="op">&gt;</span> <span class="fl">6</span>, <span class="op">]</span>, size <span class="op">=</span> <span class="fl">0.5</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Map of event locations"</span><span class="op">)</span></span></code></pre></div>
<p><img src="EDA_Italy_Horus_files/figure-html/map%20of%20locations-1.png" class="r-plt" alt="" width="700"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eventDate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hms</a></span><span class="op">(</span><span class="st">"2009-04-06 00:00:00"</span><span class="op">)</span></span>
<span><span class="va">endDate</span> <span class="op">&lt;-</span> <span class="va">eventDate</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">days</a></span><span class="op">(</span><span class="fl">400</span><span class="op">)</span></span>
<span><span class="va">startDate</span> <span class="op">&lt;-</span> <span class="va">eventDate</span> <span class="op">-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">days</a></span><span class="op">(</span><span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">deltaLat</span> <span class="op">&lt;-</span> <span class="fl">2.4</span></span>
<span><span class="va">latLims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">42.2</span>, <span class="fl">42.5</span><span class="op">)</span></span>
<span><span class="va">longLims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">13</span>, <span class="fl">13.75</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_cat</span><span class="op">[</span><span class="va">df_cat</span><span class="op">$</span><span class="va">M</span> <span class="op">&gt;</span> <span class="fl">3</span>, <span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time_date</span>, <span class="va">lat</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">df_cat</span><span class="op">[</span><span class="va">df_cat</span><span class="op">$</span><span class="va">M</span> <span class="op">&gt;</span> <span class="fl">5</span>, <span class="op">]</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time_date</span>, <span class="va">lat</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">1.2</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"orange"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">df_cat</span><span class="op">[</span><span class="va">df_cat</span><span class="op">$</span><span class="va">M</span> <span class="op">&gt;</span> <span class="fl">6</span>, <span class="op">]</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time_date</span>, <span class="va">lat</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"red"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Italian latitude-time plot"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      xmin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="va">startDate</span><span class="op">)</span>,</span>
<span>      xmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="va">endDate</span><span class="op">)</span>,</span>
<span>      ymin <span class="op">=</span> <span class="va">latLims</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>      ymax <span class="op">=</span> <span class="va">latLims</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"blue"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 1 row containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span></code></pre></div>
<p><img src="EDA_Italy_Horus_files/figure-html/unnamed-chunk-9-1.png" class="r-plt" alt="" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="analysis-if-the-laquila-sequence">Analysis if the L’Aquila Sequence<a class="anchor" aria-label="anchor" href="#analysis-if-the-laquila-sequence"></a>
</h2>
<p>To focus on the L Aquila seismic sequence is sufficient to retain
only the observations in a specific space-time-magnitude region that
include the sequence of interest. For the L’Aquila sequence, we retain
all the events with magnitude greater or equal than
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>2.5</mn><annotation encoding="application/x-tex">2.5</annotation></semantics></math>
happened during 2009 with longitude in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mn>10.5</mn><mo>,</mo><mn>16</mn><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(10.5, 16)</annotation></semantics></math>
and latitude in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mn>40.5</mn><mo>,</mo><mn>45</mn><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(40.5, 45)</annotation></semantics></math>.
The L’Aquila sequence selected in this way should be composed by 1024
events. Any other seismic sequence can be selected similarly.</p>
<p>To do the selection is convenient to transform the time string in a
<code>Date</code> object and to select the rows of the Horus catalogue
verifying the conditions.</p>
<p>start.date = “2009-04-06 00:00:00 BST” end.date = “2010-01-01
00:00:00 BST” magnitude.completeness = 2.49 min.longitude = 13.00
max.longitude = 13.75 min.latitude = 42.2 max.latitude = 42.5</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eventDate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hms</a></span><span class="op">(</span><span class="st">"2009-04-06 00:00:00"</span><span class="op">)</span></span>
<span><span class="va">endDate</span> <span class="op">&lt;-</span> <span class="va">eventDate</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">days</a></span><span class="op">(</span><span class="fl">400</span><span class="op">)</span></span>
<span><span class="va">startDate</span> <span class="op">&lt;-</span> <span class="va">eventDate</span> <span class="op">-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">days</a></span><span class="op">(</span><span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">deltaLat</span> <span class="op">&lt;-</span> <span class="fl">2.4</span></span>
<span><span class="va">latLims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">42.2</span>, <span class="fl">42.5</span><span class="op">)</span></span>
<span><span class="va">longLims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">13</span>, <span class="fl">13.75</span><span class="op">)</span></span>
<span></span>
<span><span class="va">minMAG</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># Subset the main catalogue</span></span>
<span><span class="va">df_cat.subset</span> <span class="op">&lt;-</span> <span class="va">df_cat</span><span class="op">[</span><span class="va">df_cat</span><span class="op">$</span><span class="va">M</span> <span class="op">&gt;=</span> <span class="va">minMAG</span>, <span class="op">]</span></span>
<span><span class="va">df_cat.subset</span> <span class="op">&lt;-</span> <span class="va">df_cat.subset</span><span class="op">[</span><span class="op">(</span><span class="va">df_cat.subset</span><span class="op">$</span><span class="va">lat</span> <span class="op">&gt;</span> <span class="va">latLims</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">df_cat.subset</span> <span class="op">&lt;-</span> <span class="va">df_cat.subset</span><span class="op">[</span><span class="op">(</span><span class="va">df_cat.subset</span><span class="op">$</span><span class="va">lat</span> <span class="op">&lt;</span> <span class="va">latLims</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">df_cat.subset</span> <span class="op">&lt;-</span> <span class="va">df_cat.subset</span><span class="op">[</span><span class="op">(</span><span class="va">df_cat.subset</span><span class="op">$</span><span class="va">lon</span> <span class="op">&gt;</span> <span class="va">longLims</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">df_cat.subset</span> <span class="op">&lt;-</span> <span class="va">df_cat.subset</span><span class="op">[</span><span class="op">(</span><span class="va">df_cat.subset</span><span class="op">$</span><span class="va">lon</span> <span class="op">&lt;</span> <span class="va">longLims</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df_cat.subset</span><span class="op">)</span></span>
<span><span class="co">#&gt;             time_string     lon     lat depth    M           time_date</span></span>
<span><span class="co">#&gt; 243 1961-03-25T10:40:00 13.3167 42.4333     0 3.64 1961-03-25 10:40:00</span></span>
<span><span class="co">#&gt; 295 1961-10-05T19:59:35 13.0167 42.3500     3 0.00 1961-10-05 19:59:35</span></span>
<span><span class="co">#&gt; 302 1961-10-31T00:00:00 13.0167 42.3500    10 3.94 1961-10-31 00:00:00</span></span>
<span><span class="co">#&gt; 303 1961-10-31T00:00:00 13.0167 42.3500    10 3.94 1961-10-31 00:00:00</span></span>
<span><span class="co">#&gt; 304 1961-10-31T13:37:18 13.0833 42.4167     4 4.64 1961-10-31 13:37:18</span></span>
<span><span class="co">#&gt; 305 1961-10-31T13:41:59 13.0833 42.4167     0 4.14 1961-10-31 13:41:59</span></span>
<span><span class="co">#&gt;     event_num       Time Year</span></span>
<span><span class="co">#&gt; 243       243 1961-03-25 1961</span></span>
<span><span class="co">#&gt; 295       295 1961-10-05 1961</span></span>
<span><span class="co">#&gt; 302       302 1961-10-31 1961</span></span>
<span><span class="co">#&gt; 303       303 1961-10-31 1961</span></span>
<span><span class="co">#&gt; 304       304 1961-10-31 1961</span></span>
<span><span class="co">#&gt; 305       305 1961-10-31 1961</span></span></code></pre></div>
<div class="section level3">
<h3 id="plot-of-the-event-magnitude-time-series-laquila">Plot of the event magnitude time series: l’Aquila<a class="anchor" aria-label="anchor" href="#plot-of-the-event-magnitude-time-series-laquila"></a>
</h3>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">df_cat.subset</span><span class="op">[</span><span class="va">df_cat.subset</span><span class="op">$</span><span class="va">M</span> <span class="op">&gt;</span> <span class="fl">3</span>, <span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time_date</span>, <span class="va">lat</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">df_cat.subset</span><span class="op">[</span><span class="va">df_cat.subset</span><span class="op">$</span><span class="va">M</span> <span class="op">&gt;</span> <span class="fl">5</span>, <span class="op">]</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time_date</span>, <span class="va">lat</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">1.2</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"orange"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">df_cat.subset</span><span class="op">[</span><span class="va">df_cat.subset</span><span class="op">$</span><span class="va">M</span> <span class="op">&gt;</span> <span class="fl">6</span>, <span class="op">]</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time_date</span>, <span class="va">lat</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"red"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"L'Aquila latitude-time plot"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      xmin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="va">startDate</span><span class="op">)</span>,</span>
<span>      xmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="va">endDate</span><span class="op">)</span>,</span>
<span>      ymin <span class="op">=</span> <span class="va">latLims</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>      ymax <span class="op">=</span> <span class="va">latLims</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.4</span>, fill <span class="op">=</span> <span class="st">"blue"</span>, color <span class="op">=</span> <span class="st">"blue"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="EDA_Italy_Horus_files/figure-html/unnamed-chunk-10-1.png" class="r-plt" alt="" width="700"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">minMag</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">maxMag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">df_cat.subset</span><span class="op">$</span><span class="va">M</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mags</span> <span class="op">&lt;-</span> <span class="va">df_cat.subset</span><span class="op">[</span><span class="va">df_cat.subset</span><span class="op">$</span><span class="va">M</span> <span class="op">&gt;=</span> <span class="va">minMag</span>, <span class="op">]</span><span class="op">$</span><span class="va">M</span></span>
<span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">mags</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">minMag</span> <span class="op">-</span> <span class="fl">0.05</span>, <span class="va">maxMag</span> <span class="op">+</span> <span class="fl">0.4</span>, <span class="fl">0.1</span><span class="op">)</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">N.counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">$</span><span class="va">counts</span><span class="op">)</span></span>
<span><span class="va">tmp</span><span class="op">$</span><span class="va">cumulativeCounts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">$</span><span class="va">counts</span><span class="op">[</span><span class="va">N.counts</span><span class="op">:</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="va">N.counts</span><span class="op">:</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="va">m.min</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span><span class="va">bin_m.min</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">$</span><span class="va">mids</span> <span class="op">==</span> <span class="va">m.min</span><span class="op">)</span></span>
<span><span class="va">freq_m.min</span> <span class="op">&lt;-</span> <span class="va">tmp</span><span class="op">$</span><span class="va">counts</span><span class="op">[</span><span class="va">bin_m.min</span><span class="op">]</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fl">1.</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">tmp</span><span class="op">$</span><span class="va">mids</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">freq_m.min</span> <span class="op">*</span> <span class="fl">10</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="va">b</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">m.min</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">y.cum</span> <span class="op">&lt;-</span> <span class="va">tmp</span><span class="op">$</span><span class="va">cumulativeCounts</span><span class="op">[</span><span class="va">bin_m.min</span><span class="op">]</span> <span class="op">*</span> <span class="fl">10</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="va">b</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">m.min</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">tmp</span><span class="op">$</span><span class="va">mids</span>, y <span class="op">=</span> <span class="va">tmp</span><span class="op">$</span><span class="va">counts</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">tmp</span><span class="op">$</span><span class="va">mids</span>, y <span class="op">=</span> <span class="va">tmp</span><span class="op">$</span><span class="va">cumulativeCounts</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    pch <span class="op">=</span> <span class="st">"+"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Frequency-magnitude plot with arbitary GR dist: b ="</span>, <span class="va">b</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Magnitude"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"log10(Frequency)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y.cum</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">m.min</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in scale_y_log10(): <span style="color: #00BB00;">log-10</span> transformation introduced infinite values.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">log-10</span> transformation introduced infinite values.</span></span></code></pre></div>
<p><img src="EDA_Italy_Horus_files/figure-html/regional%20GR%20Plot-1.png" class="r-plt" alt="" width="700"></p>
</div>
<div class="section level3">
<h3 id="b-value-stability-plot-laquila">b-value stability plot: l’Aquila<a class="anchor" aria-label="anchor" href="#b-value-stability-plot-laquila"></a>
</h3>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">minMag</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">maxMag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">df_cat.subset</span><span class="op">$</span><span class="va">M</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">mags</span> <span class="op">&lt;-</span> <span class="va">df_cat.subset</span><span class="op">[</span><span class="va">df_cat.subset</span><span class="op">$</span><span class="va">M</span> <span class="op">&gt;=</span> <span class="va">minMag</span>, <span class="op">]</span><span class="op">$</span><span class="va">M</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">minMag</span>, <span class="va">maxMag</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">b.stability.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">b.error.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">m.mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">b_utsu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">b_guttorp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">b_elst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">delta_b_utsu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">b_elst_lower</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">b_elst_upper</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">max.index.x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">max.index.x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">mag.threshold</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">mags.subset</span> <span class="op">&lt;-</span> <span class="va">mags</span><span class="op">[</span><span class="va">mags</span> <span class="op">&gt;</span> <span class="va">mag.threshold</span><span class="op">]</span></span>
<span></span>
<span>  <span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mags.subset</span><span class="op">)</span></span>
<span>  <span class="va">b_utsu</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mags.subset</span><span class="op">)</span> <span class="op">-</span> <span class="va">mag.threshold</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">delta_b_utsu</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="op">*</span> <span class="va">b_utsu</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">**</span><span class="fl">2</span> <span class="op">*</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">mags.subset</span> <span class="op">-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mags.subset</span><span class="op">)</span><span class="op">)</span><span class="op">**</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">N</span> <span class="op">*</span> <span class="op">(</span><span class="va">N</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">b_guttorp</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="fl">0.05</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mags.subset</span><span class="op">)</span> <span class="op">-</span> <span class="va">mag.threshold</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">/</span></span>
<span>      <span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mags.subset</span><span class="op">)</span> <span class="op">-</span> <span class="va">mag.threshold</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">deltaMags</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">mags.subset</span><span class="op">)</span></span>
<span>  <span class="va">deltaMags_p</span> <span class="op">&lt;-</span> <span class="va">deltaMags</span><span class="op">[</span><span class="va">deltaMags</span> <span class="op">&gt;</span> <span class="fl">0.1</span><span class="op">]</span></span>
<span>  <span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">deltaMags_p</span><span class="op">)</span></span>
<span>  <span class="va">b_elst</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="fl">0.05</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">deltaMags_p</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">deltaMags_p</span><span class="op">)</span> <span class="op">-</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">c</span> <span class="op">&lt;-</span> <span class="fl">10</span><span class="op">**</span><span class="op">(</span><span class="fl">0.1</span> <span class="op">*</span> <span class="va">b_elst</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">b_elst_lower</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">0.1</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="op">(</span><span class="va">c</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">c</span> <span class="op">/</span> <span class="va">N</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">c</span> <span class="op">/</span> <span class="va">N</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">b_elst_upper</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">0.1</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="op">(</span><span class="va">c</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">c</span> <span class="op">/</span> <span class="va">N</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">c</span> <span class="op">/</span> <span class="va">N</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">max.index.x</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">b_utsu</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">max.index.x</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">b_utsu</span> <span class="op">+</span> <span class="va">delta_b_utsu</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="fl">2</span>, lty <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">max.index.x</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">b_utsu</span> <span class="op">-</span> <span class="va">delta_b_utsu</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="fl">2</span>, lty <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">max.index.x</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">b_guttorp</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="fl">3</span>, lty <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Magnitude threshold"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"b-value estimate"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">1</span>, lty <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0.85</span>, lty <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"b-value stability plot for the l'Aquila catalogue"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 2 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span>
<span><span class="co">#&gt; Removed 2 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span></code></pre></div>
<p><img src="EDA_Italy_Horus_files/figure-html/unnamed-chunk-11-1.png" class="r-plt" alt="" width="700"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Francesco Serafini, Mark Naylor, Finn Lindgren.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
