# ETAS.inlabru

R package that implements the ETAS Hawkes process for modelling
seismicity

Online documentation:
<https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/>

## Authors

- [Dr Francesco
  Serafini](https://scholar.google.com/citations?user=NVDOxTcAAAAJ&hl=en)
- [Dr Mark Naylor](https://blogs.ed.ac.uk/mnaylor/) , School of
  GeoSciences, University of Edinburgh
- [Prof Finn Lindgren](https://www.maths.ed.ac.uk/~flindgre/) , School
  of Mathematics, University of Edinburgh
- [Dr Kirsty
  Bayliss](https://www.linkedin.com/in/kirsty-bayliss-9a6604a1/?originalSubdomain=uk)
  , Global Earthquake Model (GEM)

## Funding

- This study was funded by yhe Real-Time Earthquake Risk Reduction for a
  Resilient Europe [RISE project](http://www.rise-eu.org/home/) , which
  has received funding from the European Union’s Horizon 2020 Research
  and Innovation Program under grant Agreement 821115.
- Naylor was additionally funded by the NSFGEO-NERC grant NE/R000794/1.
- Bayliss was funded by an EPSRC Studentship.

## Installation

For ETAS.inlabru to work, we need to install both R-INLA and inlabru:

For inlabru (see <https://inlabru-org.github.io/inlabru/>):

- CRAN release,

``` r
install.packages("inlabru")
```

- or development version,

``` r
# install.packages("remotes")
remotes::install_github("inlabru-org/inlabru")
```

For R-INLA (see <https://www.r-inla.org/download-install>):

``` r
install.packages(
  "INLA",
  repos = c(getOption("repos"), INLA="https://inla.r-inla-download.org/R/testing"),
  dep = TRUE
)
```

You can install the development version of ETAS.inlabru from
[GitHub](https://github.com/) with

``` r
# install.packages("remotes")
remotes::install_github("edinburgh-seismicity-hub/ETAS.inlabru")
```

## Terminology and planning suggestions

### File structure in package

- ETAS.triggering.function.R : Contains the ETAS specific model
  functions
- HawkesProcess.R : Generic Hawkes code that is intended for integration
  back into inlabru
- generateSyntheticCatalogues.R : Contains the iterative Hawkes
  functions for generating triggered events but the actual triggering
  functions reside in the ETAS file above so we could introduce other
  models here
- temporalBinning.R : Code to generate time bins to make integration
  scheme efficient
- plottingFunctions.R : lets put all the standard plotting functions
  into here
- setupInlabruInputs.R : Put the functions for generating input.list in
  here

## Terminology

- Let’s be specific about when we are doing just temporal so we have
  clear function names for the spatial and spatial-temporal later on
- I changed the theta from `c(mu, K, ...)` to a
  `df <- data.frame(mu=mu, K=K, alpha=alpha, c=c, p=p)`. This means we
  should refer to the values as `df$mu` which is unambiguous etc

# What has been done

## Implemented

- Generation of synthetic ETAS catalogues by `ETAS.inlabru` with a
  demonstration in the notebook

## In development

- Add inversion modelling based on original code
- Modify the implementation so that the generic Hawkes code can go into
  inlabru and the ETAS triggering function code stay in this package

## Roadmap

- Integrate spatial modelling

# Package index

## All functions

- [`IntInjectionIntensity()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/IntInjectionIntensity.md)
  [`Inv_IntInjectionIntensity()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/IntInjectionIntensity.md)
  : Injection Rate function calculations

- [`Int_ETAS_time_trig_function()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/Int_ETAS_time_trig_function.md)
  : Integrated Omori's law

- [`Inv_Int_ETAS_time_trig_function()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/Inv_Int_ETAS_time_trig_function.md)
  : Inverse of integrated Omori's law

- [`It_df()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/It_df.md)
  : Function to calculate the integral of Omori's law

- [`Temporal.ETAS()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/Temporal.ETAS.md)
  : Function to fit Hawkes process model

- [`Temporal.ETAS.fit()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/Temporal.ETAS.fit.md)
  : Fit temporal ETAS model

- [`Temporal.ETAS.forecast()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/Temporal.ETAS.forecast.md)
  : Title

- [`breaks_exp()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/breaks_exp.md)
  : Find breaks point for 1D grid

- [`compute_grid()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/compute_grid.md)
  : Integral of Omori's law

- [`cond_lambda()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/cond_lambda.md)
  :

  ETAS conditional intensity - used by `inlabru`

- [`create_input_list_temporal_noCatalogue()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/create_input_list_temporal_noCatalogue.md)
  : Create input list for ETAS Hawkes temporal model without catalogue

- [`create_input_list_temporal_withCatalogue()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/create_input_list_temporal_withCatalogue.md)
  : Create input list for ETAS Hawkes temporal model with catalogue

- [`exp_t()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/exp_t.md)
  : Copula transformation from a standard Normal distribution to an
  Exponential distribution

- [`gamma_t()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/gamma_t.md)
  : Copula transformation from a standard Normal distribution to a Gamma
  distribution

- [`generate_temporal_ETAS_synthetic()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/generate_temporal_ETAS_synthetic.md)
  : Generates a synthetic catalogue using the ETAS model

- [`get_posterior_N()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/get_posterior_N.md)
  : Plot the posterior distribution of the expected number of events

- [`get_posterior_param()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/get_posterior_param.md)
  : Retrieve posterior distribution of ETAS parameters

- [`gt()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/gt.md)
  :

  ETAS triggering function - used by `inlabru`

- [`horus`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/horus.md)
  : HORUS Ita Catalogue

- [`inv_exp_t()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/inv_exp_t.md)
  : Copula transformation from an Exponential to a standard Normal
  distribution

- [`inv_gamma_t()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/inv_gamma_t.md)
  : Copula transformation from an Gamma to a standard Normal
  distribution

- [`inv_loggaus_t()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/inv_loggaus_t.md)
  : Copula transformation from an Log-Normal to a standard Normal
  distribution

- [`inv_unif_t()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/inv_unif_t.md)
  : Copula transformation from an Uniform to a standard Normal
  distribution

- [`lambda_N()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/lambda_N.md)
  : Calculate the integral of the ETAS conditional intensity

- [`log_Lambda_h()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/log_Lambda_h.md)
  : Logarithm of the integral of the ETAS triggering function

- [`loggaus_t()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/loggaus_t.md)
  : Copula transformation from a standard Normal distribution to a
  Log-Normal distribution

- [`omori()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/omori.md)
  : Function to calculate Omori's law

- [`omori_plot_posterior()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/omori_plot_posterior.md)
  : Function to plot Omori's law corresponding to different posterior
  samples

- [`omori_plot_prior()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/omori_plot_prior.md)
  : Plot Omori's law for prior samples

- [`post_pairs_plot()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/post_pairs_plot.md)
  : Plot the posterior densities of the ETAS parameters

- [`post_sampling()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/post_sampling.md)
  : Sample from the posterior of the ETAS parameters

- [`sample_GR_magnitudes()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/sample_GR_magnitudes.md)
  : Return a sample of magnitudes drawn from the GR distribution

- [`sample_temporal_ETAS_daughters()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/sample_temporal_ETAS_daughters.md)
  : Sample daughter events from one parent using the ETAS model

- [`sample_temporal_ETAS_generation()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/sample_temporal_ETAS_generation.md)
  :

  Take all previous parent events from `Ht=data.frame[ts, magnitudes]`
  and generates their daughters events using the ETAS model

- [`sample_temporal_ETAS_times()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/sample_temporal_ETAS_times.md)
  : Sample times for events triggered by a parent according to the ETAS
  triggering function

- [`sample_temporal_injection_events()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/sample_temporal_injection_events.md)
  : Title

- [`time_grid()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/time_grid.md)
  : Generate a set of time bins for a specific event.

- [`triggering_fun_plot()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/triggering_fun_plot.md)
  : Triggering function plot from posterior samples

- [`triggering_fun_plot_prior()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/triggering_fun_plot_prior.md)
  : Triggering function plot from prior samples

- [`unif_t()`](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/reference/unif_t.md)
  : Copula transformation from a standard Normal distribution to a
  Uniform distribution

# Articles

### All vignettes

- [1. Exploratory Data Analysis: Italian Earthquake Catalogue -
  Horus](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/articles/EDA_Italy_Horus.md):
- [2a Temporal Model: Generating synthetic temporal ETAS
  catalogues](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/articles/generateSyntheticCatalogues.md):
- [2b Temporal Model: Presenting samples drawn from the ETAS
  priors](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/articles/sampleFromETASpriors.md):
- [Sensitivity to starting
  point](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/articles/sensitivityToStartingPoint.md):
- [2d Temporal Model: Tutorial on real
  data](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/articles/tutorial_real.md):
- [2c Temporal Model: Tutorial on synthetic
  data](https://edinburgh-seismicity-hub.github.io/ETAS.inlabru/articles/tutorial_synth.md):
